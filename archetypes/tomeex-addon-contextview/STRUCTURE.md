# 📁 Struttura Progetto Generato - WebApp = Modulo Unico

## 🎯 Architettura

**Principio fondamentale:** Una webapp generata = Un modulo singolo

- ❌ **NO** multi-modulo
- ✅ **SÌ** configurazione JSON centralizzata

---

## 🏗️ Struttura Completa Generata

```
my-scenario-app/              ← Generated by archetype
│
├── pom.xml                   ← Maven build configuration
│
├── src/
│   ├── main/
│   │   ├── java/com/mycompany/scenario/
│   │   │   ├── core/
│   │   │   │   ├── Scenario.java
│   │   │   │   └── ScenarioOptions.java
│   │   │   │
│   │   │   ├── processor/
│   │   │   │   ├── ScenarioProcessor.java
│   │   │   │   ├── RoleAuthorizationFilter.java
│   │   │   │   ├── BreadcrumbGenerator.java
│   │   │   │   └── SchemaValidator.java
│   │   │   │
│   │   │   └── servlet/
│   │   │       └── ScenarioServlet.java
│   │   │
│   │   ├── resources/
│   │   │   └── logback.xml
│   │   │
│   │   └── webapp/
│   │       ├── WEB-INF/
│   │       │   ├── web.xml
│   │       │   └── scenarios/        ★ JSON Configuration Directory
│   │       │       └── json/
│   │       │           ├── my-scenario-app.json    ★ Main config
│   │       │           └── forms/
│   │       │               ├── EXAMPLE_LIST.json
│   │       │               └── EXAMPLE_FORM.json
│   │       │
│   │       └── index.html
│   │
│   └── test/java/
│
└── target/
    └── my-scenario-app.war   ← Deployable WAR
```

---

## 📄 File Configurazione

### 1. **Main Configuration** - `webapp/WEB-INF/scenarios/json/{artifactId}.json`

**Path completo esempio:**
```
webapp/WEB-INF/scenarios/json/my-scenario-app.json
```

**Contenuto:**
```json
{
  "name": "my-scenario-app",
  "scenarios": {
    "HOME": {
      "route": "/home"
    },
    "LIST_PRODUCTS": {
      "title": "Products",
      "route": "products",
      "component": "custom-grid",
      "options": {
        "schema": "PRODUCT_LIST",
        "api": [...]
      }
    }
  }
}
```

**Cosa contiene:**
- ✅ Metadata webapp
- ✅ TUTTI gli scenari (HOME, LIST, FORM, DETAIL)
- ✅ Menu configuration
- ✅ Traduzioni/icone

---

### 2. **Schema Files** - `webapp/WEB-INF/scenarios/json/forms/*.json`

**Path completo esempio:**
```
webapp/WEB-INF/scenarios/json/forms/PRODUCT_LIST.json
webapp/WEB-INF/scenarios/json/forms/PRODUCT_FORM.json
```

**Contenuto PRODUCT_FORM.json:**
```json
{
  "schema": {
    "id": {"type": "number", "title": "ID", "readOnly": true},
    "name": {"type": "string", "title": "Name", "required": true}
  },
  "form": [
    {"key": "id"},
    {"key": "name"}
  ]
}
```

**Quando viene caricato:**
Quando il main config ha `"schema": "PRODUCT_FORM"`, viene caricato automaticamente da:
```
json/forms/PRODUCT_FORM.json
```

---

## 🌐 API Endpoints

### Architettura Semplificata (NO moduleName!)

| Endpoint | Descrizione | Esempio |
|----------|-------------|---------|
| `GET /api/scenario/config` | Configurazione completa webapp | `/api/scenario/config?role=admin` |
| `GET /api/scenario/list` | Lista tutti gli scenari | `/api/scenario/list` |
| `GET /api/scenario/{scenarioKey}` | Dettaglio scenario specifico | `/api/scenario/LIST_PRODUCTS` |

### Prima (SBAGLIATO - multi-modulo):
```
❌ GET /api/scenario/config/MyModule
❌ GET /api/scenario/MyModule/LIST_PRODUCTS
```

### Ora (CORRETTO - single module):
```
✅ GET /api/scenario/config
✅ GET /api/scenario/LIST_PRODUCTS
```

---

## ⚙️ Configurazione web.xml

```xml
<context-param>
    <param-name>app.name</param-name>
    <param-value>my-scenario-app</param-value>
</context-param>

<context-param>
    <param-name>scenarios.path</param-name>
    <param-value>${catalina.base}/webapps/my-scenario-app/WEB-INF/scenarios</param-value>
</context-param>
```

**Come funziona:**

1. `app.name` = `${artifactId}` (es: "my-scenario-app")
2. Servlet carica: `{scenarios.path}/json/{app.name}.json`
3. Path finale: `WEB-INF/scenarios/json/my-scenario-app.json`

---

## 🔄 Flusso Processing

```
User Request: GET /api/scenario/config?role=admin
      ↓
ScenarioServlet.handleGetConfiguration()
      ↓
jsonPath = "json/my-scenario-app.json"
      ↓
ScenarioProcessor.processConfiguration(jsonPath, role, ...)
      ↓
1. Load: WEB-INF/scenarios/json/my-scenario-app.json
2. For each scenario with schema:
   - Load: json/forms/{SCHEMA_NAME}.json
   - Process transformations
   - Inline into scenario
3. Apply role filtering
4. Generate breadcrumbs
      ↓
Return processed JSON to frontend
```

---

## 📝 Come Aggiungere Nuovi Scenari

### 1. Aggiungi scenario al main config

Edita `webapp/WEB-INF/scenarios/json/my-scenario-app.json`:

```json
{
  "scenarios": {
    "LIST_ORDERS": {
      "title": "Orders",
      "route": "orders",
      "component": "custom-grid",
      "options": {
        "schema": "ORDER_LIST",
        "api": [{"method": "GET", "url": "api/orders"}]
      }
    }
  }
}
```

### 2. Crea schema file

Crea `webapp/WEB-INF/scenarios/json/forms/ORDER_LIST.json`:

```json
{
  "schema": {
    "id": {"type": "number", "title": "Order ID"},
    "customer": {"type": "string", "title": "Customer"},
    "total": {"type": "number", "title": "Total"}
  },
  "grid": [
    {"key": "id"},
    {"key": "customer"},
    {"key": "total"}
  ]
}
```

### 3. Deploy & Test

```bash
mvn clean package
# Deploy WAR to Tomcat
curl http://localhost:8080/my-scenario-app/api/scenario/LIST_ORDERS
```

**DONE!** ✅

---

## 🎨 Esempio Completo: E-commerce

### Struttura File

```
webapp/WEB-INF/scenarios/json/
├── shop-webapp.json              ← Main config
└── forms/
    ├── PRODUCT_LIST.json
    ├── PRODUCT_FORM.json
    ├── ORDER_LIST.json
    ├── ORDER_FORM.json
    ├── CUSTOMER_LIST.json
    └── CUSTOMER_FORM.json
```

### Main Config: `shop-webapp.json`

```json
{
  "name": "shop-webapp",
  "scenarios": {
    "HOME": {"route": "/home"},

    "LIST_PRODUCTS": {
      "title": "Products",
      "route": "products",
      "component": "custom-grid",
      "options": {
        "schema": "PRODUCT_LIST",
        "api": [{"method": "GET", "url": "api/products"}],
        "actions-row": {
          "items": [{
            "code": "edit",
            "title": "Edit",
            "goto-scenario": "PRODUCT_FORM"
          }]
        }
      }
    },

    "PRODUCT_FORM": {
      "title": "Edit Product",
      "route": "products/edit",
      "component": "custom-form",
      "options": {
        "schema": "PRODUCT_FORM",
        "schema_mode": "update",
        "api": [
          {"operation": "data", "method": "GET", "url": "api/products/<master_id>"},
          {"operation": "save", "method": "PUT", "url": "api/products/<master_id>"}
        ]
      }
    },

    "LIST_ORDERS": { /* ... */ },
    "ORDER_FORM": { /* ... */ }
  }
}
```

---

## ✅ Vantaggi Architettura Single-Module

1. ✅ **Semplicità**: Un solo file di configurazione principale
2. ✅ **Chiarezza**: Path prevedibili e coerenti
3. ✅ **Deployment**: WAR autonomo e completo
4. ✅ **Manutenzione**: Facile capire dove modificare
5. ✅ **API Pulite**: Endpoint semplificati senza `{moduleName}`

---

## 📚 Riepilogo Paths

```
Progetto:     my-scenario-app/
Config base:  webapp/WEB-INF/scenarios/
Main config:  json/my-scenario-app.json
Forms:        json/forms/*.json

URL config:   http://localhost:8080/my-scenario-app/api/scenario/config
URL scenario: http://localhost:8080/my-scenario-app/api/scenario/{KEY}
```

**Tutto parte da un singolo file JSON principale!** 🎯
