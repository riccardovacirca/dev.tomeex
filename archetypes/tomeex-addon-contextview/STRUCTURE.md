# ğŸ“ Struttura Progetto Generato - WebApp = Modulo Unico

## ğŸ¯ Architettura

**Principio fondamentale:** Una webapp generata = Un modulo singolo

- âŒ **NO** multi-modulo
- âœ… **SÃŒ** configurazione JSON centralizzata

---

## ğŸ—ï¸ Struttura Completa Generata

```
my-scenario-app/              â† Generated by archetype
â”‚
â”œâ”€â”€ pom.xml                   â† Maven build configuration
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/mycompany/scenario/
â”‚   â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Scenario.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ScenarioOptions.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ processor/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ScenarioProcessor.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RoleAuthorizationFilter.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ BreadcrumbGenerator.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SchemaValidator.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ servlet/
â”‚   â”‚   â”‚       â””â”€â”€ ScenarioServlet.java
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”‚   â””â”€â”€ logback.xml
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ webapp/
â”‚   â”‚       â”œâ”€â”€ WEB-INF/
â”‚   â”‚       â”‚   â”œâ”€â”€ web.xml
â”‚   â”‚       â”‚   â””â”€â”€ scenarios/        â˜… JSON Configuration Directory
â”‚   â”‚       â”‚       â””â”€â”€ json/
â”‚   â”‚       â”‚           â”œâ”€â”€ my-scenario-app.json    â˜… Main config
â”‚   â”‚       â”‚           â””â”€â”€ forms/
â”‚   â”‚       â”‚               â”œâ”€â”€ EXAMPLE_LIST.json
â”‚   â”‚       â”‚               â””â”€â”€ EXAMPLE_FORM.json
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ index.html
â”‚   â”‚
â”‚   â””â”€â”€ test/java/
â”‚
â””â”€â”€ target/
    â””â”€â”€ my-scenario-app.war   â† Deployable WAR
```

---

## ğŸ“„ File Configurazione

### 1. **Main Configuration** - `webapp/WEB-INF/scenarios/json/{artifactId}.json`

**Path completo esempio:**
```
webapp/WEB-INF/scenarios/json/my-scenario-app.json
```

**Contenuto:**
```json
{
  "name": "my-scenario-app",
  "scenarios": {
    "HOME": {
      "route": "/home"
    },
    "LIST_PRODUCTS": {
      "title": "Products",
      "route": "products",
      "component": "custom-grid",
      "options": {
        "schema": "PRODUCT_LIST",
        "api": [...]
      }
    }
  }
}
```

**Cosa contiene:**
- âœ… Metadata webapp
- âœ… TUTTI gli scenari (HOME, LIST, FORM, DETAIL)
- âœ… Menu configuration
- âœ… Traduzioni/icone

---

### 2. **Schema Files** - `webapp/WEB-INF/scenarios/json/forms/*.json`

**Path completo esempio:**
```
webapp/WEB-INF/scenarios/json/forms/PRODUCT_LIST.json
webapp/WEB-INF/scenarios/json/forms/PRODUCT_FORM.json
```

**Contenuto PRODUCT_FORM.json:**
```json
{
  "schema": {
    "id": {"type": "number", "title": "ID", "readOnly": true},
    "name": {"type": "string", "title": "Name", "required": true}
  },
  "form": [
    {"key": "id"},
    {"key": "name"}
  ]
}
```

**Quando viene caricato:**
Quando il main config ha `"schema": "PRODUCT_FORM"`, viene caricato automaticamente da:
```
json/forms/PRODUCT_FORM.json
```

---

## ğŸŒ API Endpoints

### Architettura Semplificata (NO moduleName!)

| Endpoint | Descrizione | Esempio |
|----------|-------------|---------|
| `GET /api/scenario/config` | Configurazione completa webapp | `/api/scenario/config?role=admin` |
| `GET /api/scenario/list` | Lista tutti gli scenari | `/api/scenario/list` |
| `GET /api/scenario/{scenarioKey}` | Dettaglio scenario specifico | `/api/scenario/LIST_PRODUCTS` |

### Prima (SBAGLIATO - multi-modulo):
```
âŒ GET /api/scenario/config/MyModule
âŒ GET /api/scenario/MyModule/LIST_PRODUCTS
```

### Ora (CORRETTO - single module):
```
âœ… GET /api/scenario/config
âœ… GET /api/scenario/LIST_PRODUCTS
```

---

## âš™ï¸ Configurazione web.xml

```xml
<context-param>
    <param-name>app.name</param-name>
    <param-value>my-scenario-app</param-value>
</context-param>

<context-param>
    <param-name>scenarios.path</param-name>
    <param-value>${catalina.base}/webapps/my-scenario-app/WEB-INF/scenarios</param-value>
</context-param>
```

**Come funziona:**

1. `app.name` = `${artifactId}` (es: "my-scenario-app")
2. Servlet carica: `{scenarios.path}/json/{app.name}.json`
3. Path finale: `WEB-INF/scenarios/json/my-scenario-app.json`

---

## ğŸ”„ Flusso Processing

```
User Request: GET /api/scenario/config?role=admin
      â†“
ScenarioServlet.handleGetConfiguration()
      â†“
jsonPath = "json/my-scenario-app.json"
      â†“
ScenarioProcessor.processConfiguration(jsonPath, role, ...)
      â†“
1. Load: WEB-INF/scenarios/json/my-scenario-app.json
2. For each scenario with schema:
   - Load: json/forms/{SCHEMA_NAME}.json
   - Process transformations
   - Inline into scenario
3. Apply role filtering
4. Generate breadcrumbs
      â†“
Return processed JSON to frontend
```

---

## ğŸ“ Come Aggiungere Nuovi Scenari

### 1. Aggiungi scenario al main config

Edita `webapp/WEB-INF/scenarios/json/my-scenario-app.json`:

```json
{
  "scenarios": {
    "LIST_ORDERS": {
      "title": "Orders",
      "route": "orders",
      "component": "custom-grid",
      "options": {
        "schema": "ORDER_LIST",
        "api": [{"method": "GET", "url": "api/orders"}]
      }
    }
  }
}
```

### 2. Crea schema file

Crea `webapp/WEB-INF/scenarios/json/forms/ORDER_LIST.json`:

```json
{
  "schema": {
    "id": {"type": "number", "title": "Order ID"},
    "customer": {"type": "string", "title": "Customer"},
    "total": {"type": "number", "title": "Total"}
  },
  "grid": [
    {"key": "id"},
    {"key": "customer"},
    {"key": "total"}
  ]
}
```

### 3. Deploy & Test

```bash
mvn clean package
# Deploy WAR to Tomcat
curl http://localhost:8080/my-scenario-app/api/scenario/LIST_ORDERS
```

**DONE!** âœ…

---

## ğŸ¨ Esempio Completo: E-commerce

### Struttura File

```
webapp/WEB-INF/scenarios/json/
â”œâ”€â”€ shop-webapp.json              â† Main config
â””â”€â”€ forms/
    â”œâ”€â”€ PRODUCT_LIST.json
    â”œâ”€â”€ PRODUCT_FORM.json
    â”œâ”€â”€ ORDER_LIST.json
    â”œâ”€â”€ ORDER_FORM.json
    â”œâ”€â”€ CUSTOMER_LIST.json
    â””â”€â”€ CUSTOMER_FORM.json
```

### Main Config: `shop-webapp.json`

```json
{
  "name": "shop-webapp",
  "scenarios": {
    "HOME": {"route": "/home"},

    "LIST_PRODUCTS": {
      "title": "Products",
      "route": "products",
      "component": "custom-grid",
      "options": {
        "schema": "PRODUCT_LIST",
        "api": [{"method": "GET", "url": "api/products"}],
        "actions-row": {
          "items": [{
            "code": "edit",
            "title": "Edit",
            "goto-scenario": "PRODUCT_FORM"
          }]
        }
      }
    },

    "PRODUCT_FORM": {
      "title": "Edit Product",
      "route": "products/edit",
      "component": "custom-form",
      "options": {
        "schema": "PRODUCT_FORM",
        "schema_mode": "update",
        "api": [
          {"operation": "data", "method": "GET", "url": "api/products/<master_id>"},
          {"operation": "save", "method": "PUT", "url": "api/products/<master_id>"}
        ]
      }
    },

    "LIST_ORDERS": { /* ... */ },
    "ORDER_FORM": { /* ... */ }
  }
}
```

---

## âœ… Vantaggi Architettura Single-Module

1. âœ… **SemplicitÃ **: Un solo file di configurazione principale
2. âœ… **Chiarezza**: Path prevedibili e coerenti
3. âœ… **Deployment**: WAR autonomo e completo
4. âœ… **Manutenzione**: Facile capire dove modificare
5. âœ… **API Pulite**: Endpoint semplificati senza `{moduleName}`

---

## ğŸ“š Riepilogo Paths

```
Progetto:     my-scenario-app/
Config base:  webapp/WEB-INF/scenarios/
Main config:  json/my-scenario-app.json
Forms:        json/forms/*.json

URL config:   http://localhost:8080/my-scenario-app/api/scenario/config
URL scenario: http://localhost:8080/my-scenario-app/api/scenario/{KEY}
```

**Tutto parte da un singolo file JSON principale!** ğŸ¯
